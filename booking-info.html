<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>填寫資訊｜Reserve+</title>

<style>
body{background:#F6F8FB;margin:0;font-family:"Noto Sans TC";}
header{background:#4285F4;color:#fff;padding:18px;text-align:center;font-size:20px;font-weight:700;}
.card{background:#fff;border-radius:18px;margin:26px auto;padding:26px;max-width:480px;box-shadow:0 8px 22px rgba(0,0,0,.09);}
label{margin-top:16px;display:block;font-weight:600;}
input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #dfe3ef;margin-top:6px;}

.total{text-align:right;font-size:26px;font-weight:bold;color:#E53935;margin-top:20px;}
.btn{width:100%;padding:14px;background:#4285F4;color:white;border:none;border-radius:14px;font-size:18px;margin-top:22px;}
</style>
</head>

<body>
<header>確認您的資訊</header>
<div class="card">

  <label>姓名</label><input id="name">
  <label>手機</label><input id="phone">
  <label>備註</label><textarea id="note"></textarea>

  <div class="total">總金額：NT$ <span id="price">0</span></div>

  <button class="btn" onclick="submit()">完成預約 ✔</button>
</div>

<script>
const API="YOUR_GAS_URL";
const p=new URLSearchParams(location.search);
const room=p.get("room"),checkin=p.get("checkin"),checkout=p.get("checkout");
let rdata;

(async()=>{
 const rooms=await fetch(API+"?action=rooms").then(r=>r.json());
 rdata=rooms.find(x=>x.id===room);
 price.innerText=calc();
})();

function calc(){
 let a=new Date(checkin),b=new Date(checkout),diff=(b-a)/86400000,total=0;
 for(let i=0;i<diff;i++){
   let d=new Date(checkin);d.setDate(d.getDate()+i);
   let wd=[0,6].includes(d.getDay());
   total+=wd?rdata.weekend:rdata.weekday;
 }
 return total;
}

async function submit(){
 const res=await fetch(API+"?action=createBooking",{
   method:"POST",
   body:JSON.stringify({
     room_id:room,name:name.value,phone:phone.value,
     checkin,checkout,note:note.value
   })
 }).then(r=>r.json());

 if(res.success)location.href="success.html?id="+res.order_id;
 else alert("⚠ "+res.message);
}
</script>
</body>
</html>
