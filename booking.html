<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>確認訂房</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="assets/style.css">
</head>

<body>
<header><h2>填寫訂房資料</h2></header>

<section class="card">

  <div id="roomInfo"></div>

  <label>姓名 *</label>
  <input id="name" required>

  <label>手機 *</label>
  <input id="phone" required placeholder="0912345678">

  <label>Email</label>
  <input id="email">

  <label>備註</label>
  <textarea id="note"></textarea>

  <button onclick="submitBooking()">送出訂單 ✔</button>
</section>

<script>
const url=new URL(location.href);
const room=url.searchParams.get("room");
const ci=url.searchParams.get("ci");
const co=url.searchParams.get("co");

async function loadRoom(){
  const res= await fetch(`/api/rooms?id=${room}`);
  const r= (await res.json()).room;

  document.getElementById("roomInfo").innerHTML=
  `<h3>${r.title}</h3>
   <p>${r.desc}</p>
   <p>入住：${ci} → 退房：${co}</p>
   <strong>價格：NT$${r.price}</strong>`;
}
loadRoom();

async function submitBooking(){
  const body={
    room_id:room,
    date_start:ci,
    date_end:co,
    name:name.value,
    phone:phone.value,
    email:email.value,
    note:note.value
  };

  const res=await fetch("/api/createBooking",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(body)
  });

  const data = await res.json();
  alert(data.success ? "預訂成功!" : "失敗 請稍後再試");
}
</script>

</body>
</html>
