<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>Google Reserve Style Wizard è¨‚æˆ¿</title>

<style>
body{
  font-family:"Noto Sans TC";
  background:#f7f7f7;
  margin:0;padding:0;
}
.container{
  max-width:600px;
  margin:auto;
  padding:24px;
}

.step{
  display:none;
  background:white;
  padding:24px;
  border-radius:16px;
  box-shadow:0 4px 15px rgba(0,0,0,.08);
}
.step.active{display:block;}

.card{
  border:1px solid #ddd;
  padding:14px;
  border-radius:10px;
  margin-bottom:12px;
  cursor:pointer;
  transition:.2s;
}
.card:hover{border-color:#007AFF;transform:scale(1.01);}

button{
  width:100%;background:#007AFF;color:white;
  padding:14px;font-size:18px;border:none;border-radius:10px;
  cursor:pointer;margin-top:14px;
}
button.back{background:#ccc;color:black;}

h2{margin-top:0;}
</style>
</head>

<body>
<div class="container">

<!-- Step1ï¼šé¸æˆ¿ -->
<div class="step active" id="step1">
  <h2>â‘  é¸æ“‡æˆ¿å‹</h2>
  <div id="roomList"></div>
  <button onclick="nextStep()">ä¸‹ä¸€æ­¥ â†’ æ—¥æœŸ</button>
</div>

<!-- Step2ï¼šé¸æ—¥æœŸ -->
<div class="step" id="step2">
  <h2>â‘¡ é¸æ“‡å…¥ä½æ—¥æœŸ</h2>
  <input type="date" id="date" style="width:100%;padding:12px;">
  <br><br>
  <button class="back" onclick="prevStep()">â† è¿”å›</button>
  <button onclick="nextStep()">ä¸‹ä¸€æ­¥ â†’ äººæ•¸</button>
</div>

<!-- Step3ï¼šé¸äººæ•¸ -->
<div class="step" id="step3">
  <h2>â‘¢ å…¥ä½äººæ•¸</h2>
  <input type="number" id="people" value="2" min="1" style="width:100%;padding:12px;">
  <br><br>
  <button class="back" onclick="prevStep()">â† è¿”å›</button>
  <button onclick="nextStep()">ä¸‹ä¸€æ­¥ â†’ å¡«å¯«è³‡æ–™</button>
</div>

<!-- Step4ï¼šè³‡æ–™å¡«å¯« + é€å‡º -->
<div class="step" id="step4">
  <h2>â‘£ å¡«å¯«è¨‚æˆ¿è³‡æ–™</h2>
  <input id="name" placeholder="å§“å" style="width:100%;padding:12px;"><br><br>
  <input id="phone" placeholder="æ‰‹æ©Ÿ" style="width:100%;padding:12px;"><br><br>
  <input type="number" id="nights" min="1" value="1" style="width:100%;padding:12px;"><br><br>

  <h3>ğŸ’° ä½å®¿é‡‘é¡ï¼š<span id="priceShow">0</span> å…ƒ</h3>

  <button class="back" onclick="prevStep()">â† è¿”å›</button>
  <button onclick="submitBooking()">ç¢ºèªè¨‚æˆ¿</button>
</div>

</div>


<script>
/* ============================================================
   ğŸ”— API Endpointï¼ˆä¿®æ”¹æˆä½ çš„ GAS Web App URLï¼‰
   ============================================================ */
const API = "ä½ çš„-GAS-ç¶²å€";

/* ========== Step æ§åˆ¶ ========== */
let step=1, selectedRoom=null, roomPrice=0;

function nextStep(){
  if(step===1 && !selectedRoom){ alert("è«‹å…ˆé¸æ“‡æˆ¿å‹");return; }
  step++; update();
}
function prevStep(){ step--; update(); }
function update(){
  document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
  document.getElementById("step"+step).classList.add("active");

  if(step===4){
    const total = roomPrice * document.getElementById("nights").value;
    document.getElementById("priceShow").innerText = total;
  }
}

/* ========== Stepâ‘ ï¼šå–å¾—æˆ¿å‹ ========== */
async function loadRooms(){
  const res = await fetch(`${API}?action=rooms`);
  const data = await res.json();
  const dom = document.getElementById("roomList");

  data.rooms.forEach(r=>{
    dom.innerHTML+=`
    <div class="card" onclick="selectRoom('${r.room_id}',${r.price})">
      <b>${r.name}</b><br>
      $${r.price}/æ™š ï½œ å¯ä½ ${r.capacity} äºº
    </div>`;
  })
}
loadRooms();

function selectRoom(id,price){
  selectedRoom=id;
  roomPrice=price;
  alert(`å·²é¸æ“‡æˆ¿å‹ï¼š${id}`);
}

/* ========== Stepâ‘£ï¼šé€å‡ºè¨‚å–® ========== */
async function submitBooking(){
  const total = roomPrice * document.getElementById("nights").value;
  
  const body = {
    action:"createBooking",
    room_id:selectedRoom,
    date:date.value,
    nights:nights.value,
    name:name.value,
    phone:phone.value,
    total
  };

  const r = await fetch(API,{method:"POST",body:JSON.stringify(body)});
  const d = await r.json();

  if(d.success) alert(`ğŸ‰ è¨‚æˆ¿æˆåŠŸï¼è¨‚å–®ç·¨è™Ÿï¼š${d.booking_id}`);
  else alert("æäº¤å¤±æ•—");
}
</script>

</body>
</html>
