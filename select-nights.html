<!--（前略 – 保留你原本的 HTML / 樣式）-->

<style>
  /* 新增每日明細表格 */
  .price-detail-box {
    margin-top: 15px;
    padding: 14px;
    border-radius: 12px;
    background: #f9fafc;
    border: 1px solid #e0e0e0;
  }
  .price-detail-item {
    font-size: 14px;
    margin-bottom: 6px;
    color: #444;
  }
  .price-detail-bold {
    font-weight: 700;
    color: #222;
  }
</style>

<script>
// ---- 修改：讀取 disabledDates（被訂走） & specialPrice ----
async function loadRoom() {
  const res = await fetch("data/rooms.json");
  const rooms = await res.json();

  roomData = rooms.find(r => r.id === roomId);

  disabledDates = roomData.disabledDates || [];
  specialPrice = roomData.specialPrice || {};

  document.getElementById("roomTitle").innerText =
    `${roomData.title} · 平日 $${roomData.weekdayPrice.toLocaleString()} · 假日 $${roomData.weekendPrice.toLocaleString()}`;

  renderNightButtons();
}

// ---- 新增：價格類型文字
function getPriceLabel(date, room) {
  const dateStr = date.toISOString().split("T")[0];

  if (room.specialPrice && room.specialPrice[dateStr]) {
    return "(特殊日)";
  }

  const day = date.getDay(); // 0=日、6=六
  if (day === 0 || day === 6) return "(假日)";
  return "(平日)";
}

// ---- 已整合：每日價格明細
function getDailyPriceDetails(room, checkin, nights) {
  const detailArr = [];
  let d = new Date(checkin);

  for (let i = 0; i < nights; i++) {
    const price = getPriceByDate(d, room);
    const label = getPriceLabel(d, room);

    detailArr.push({
      date: d.toISOString().split("T")[0],
      price,
      label
    });

    d.setDate(d.getDate() + 1);
  }

  return detailArr;
}

// ---- 顯示 Summary + 每日明細
function showSummary() {
  const summary = document.getElementById("summaryBox");
  summary.style.display = "block";

  const checkoutDate = getCheckoutDate(checkin, selectedNights);
  const total = calculateTotalPrice(roomData, checkin, selectedNights);

  document.getElementById("checkinText").innerText = checkin;
  document.getElementById("checkoutText").innerText = checkoutDate;
  document.getElementById("nightsText").innerText = selectedNights;
  document.getElementById("priceText").innerText = `$${total.toLocaleString()}`;

  // ---- 新增：每日明細 UI ----
  const details = getDailyPriceDetails(roomData, checkin, selectedNights);
  let html = `<div class="price-detail-box">`;

  details.forEach(item => {
    html += `
      <div class="price-detail-item">
        ${item.date} ${item.label}：
        <span class="price-detail-bold">$${item.price.toLocaleString()}</span>
      </div>`;
  });

  html += `</div>`;
  summary.insertAdjacentHTML("beforeend", html);

  // ---- 下一步 ----
  document.getElementById("nextBtn").disabled = false;
  document.getElementById("nextBtn").onclick = () => {
    const encoded = encodeURIComponent(JSON.stringify(details));

    window.location.href =
      `form.html?roomId=${roomId}&date=${checkin}`+
      `&nights=${selectedNights}&checkout=${checkoutDate}`+
      `&daily=${encoded}`;
  };
}
</script>
